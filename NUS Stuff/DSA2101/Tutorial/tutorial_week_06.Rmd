---
title: "Tutorial Week 06"
author: "Ethan Keck"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, include = TRUE,
                      fig.align = "center",  out.width = "80%")
```

## Question 1
### Question 1.1

```{r}
library(tidyverse)
qn1_1 <- read_csv("../data/yrbss.csv")
qn1_1 <- qn1_1 %>% drop_na() %>% distinct() %>%
    rename(id = record, weight_kg = stweight) %>%
    mutate(grade = as.numeric(gsub("th", "", grade))) 
    # str_remove(grade, "th")
    # gsub("\\D", "", grade)
str(qn1_1)
```

### Question 1.2

```{r}
qn1_2 <- qn1_1 %>%
    filter(bmi < 15, sex == "Female") %>%
    select(id, age, race4, weight_kg, bmi) %>% 
    mutate(height_m = sqrt(weight_kg/bmi))
str(qn1_2)
```

## Question 2
### Question 2.1

```{r}
library(readxl)
library(lubridate)
qn2_1 <- read_excel("../data/MSPUS.xls", range="A11:B255", col_names=TRUE)
qn2_1 <- qn2_1 %>% 
    rename("date"="observation_date",
        "price"="MSPUS") %>%
    mutate(date = ymd(date))
str(qn2_1)
```

### Question 2.2

```{r}
library(ggplot2)
library(scales)
ggplot(qn2_1, aes(x=date, y=price)) +
    geom_line() +
    scale_y_continuous(labels = comma) +
    labs(title = "Median Sales Prices of Houses for the United States",
    x = element_blank(), y = element_blank()) +
    theme_classic() +
    theme(text = element_text(size=15))
```

### Question 2.3

```{r}
qn2_3 <- qn2_1 %>%
    filter(date %within% interval(ymd("2023-10-31"), ymd("2015-01-01"))) %>%
    mutate(year = year(date), quarter = paste("Q", quarter(date), sep=""))
str(qn2_3)
```

### Question 2.4

```{r}
ggplot(qn2_3, aes(x=date, y=price)) +
    geom_point() +
    geom_line() +
    labs(title = "Median Housing prices, 2015âˆ’2023",
    x = element_blank(), y = element_blank()) +
    theme_classic() +
    theme(text = element_text(size=15))
```

## Question 3
```{r}
install.packages("nycflights13")
library(nycflights13)
data(flights)

flights %>% filter(dep_delay > 0) %>% 
  # count(carrier, sort=TRUE) %>%
  left_join(airlines, by="carrier")

flights <- flights %>%
  # na.omit() %>% 
  # filter(complete.cases(.)) %>%
  drop_na() %>%
  distinct()
```

### Question 3.1
```{r}
most_flights <- flights %>% 
    filter(month == 6) %>%
    count(dest) %>%
    slice_max(n)
```
1. Which destination airport received the most flights from New York in June? \
  Airport code: `r most_flights["dest"]` \
  Number of flights: `r most_flights["n"]`

### Question 3.2

```{r}
best_ave <- flights %>% 
    group_by(carrier) %>% 
    summarize(mean = mean(distance)) %>%
    slice_max(mean)
```

2. Which carrier had the greatest average distance per flights? \
Flight carrier code: `r best_ave["carrier"]` 

### Question 3.3

```{r}
fast_ave <- flights %>%
    mutate(ave_speed = distance/(air_time/60)) %>%
    slice_max(ave_speed) %>%
    select(carrier, flight, ave_speed)
```
3. Which flight traveled the fastest (highest average speed in miles per hour)? \
Flight carrier code: `r fast_ave["carrier"]` \
Flight number: `r fast_ave["flight"]`

### Question 3.4

```{r}
most_day <- flights %>%
    count(weekdays(time_hour)) %>% 
    slice_max(n)
```
4. What day of the week saw the most flights? \
Day of week: `r most_day[1]` \
Number of flights: `r most_day["n"]`